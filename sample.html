<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Web to Android</title>
</head>
<body>
  <h2>Send Message to Android App</h2>
  <input type="text" id="messageInput" placeholder="Type your message">
  <button id="sendBtn">Send to Android</button>

  <script>
    // Ensure service worker is registered and active
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').then(() => {
        if (!navigator.serviceWorker.controller) {
          location.reload(); // Reload to activate controller
        }
      });
    }

    // Web â†’ Android via MessageChannel
    document.getElementById('sendBtn').addEventListener('click', () => {
      const message = document.getElementById('messageInput').value;
      if (!navigator.serviceWorker.controller) {
        alert('Service Worker not ready yet.');
        return;
      }

      const channel = new MessageChannel();
      channel.port1.onmessage = (e) => {
        console.log('Reply from Android or SW:', e.data);
        alert('Reply: ' + e.data);
      };

      navigator.serviceWorker.controller.postMessage(message, [channel.port2]);
    });
  </script>
</body>
</html>
